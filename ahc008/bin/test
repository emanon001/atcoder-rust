#!/bin/bash -eu

cd "$(dirname ${0})"
cd ..

cargo build --release --bin a
cd tools
cargo build --release --bin tester
mkdir -p out
echo -n > out/score.txt
for in in $(seq -f "%04g" -w 0 99); do
  echo "testing ${in}.txt..."
  ../../target/release/tester ../../target/release/a < in/${in}.txt 1> out/${in}.txt 2>>out/score.txt
done
ruby -e "n=100; puts n.times.map { gets.split('= ')[1].to_i }.sum * 100 / n.to_f" < out/score.txt
